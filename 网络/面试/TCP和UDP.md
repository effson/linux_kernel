# 1. TCP (Transmission Control Protocol)
传输控制协议，<mark>面向连接</mark>，提供可靠的、基于字节流的传输


# 2. UDP (User Datagram Protocol)

# 3. TCP和UDP的区别
## 3.1 是否面向连接
### TCP面向连接（三次握手，四次挥手）
- 三次握手，四次挥手
- 端对端的连接
- 全双工通信，允许双端同时收发数据

### UDP无连接，直接发数据
- 无需三次握手，四次挥手
- 可以一对多、一对一、多对一和多对多

## 3.2 数据传输方式
### TCP基于字节流
- 把应用层的数据看作是 一串连续的字节序列，没有明确的分段边界
- 内核负责把这串字节切分成合适大小的报文段（Segment）进行发送
- 无边界：不会保留报文边界
- 粘包/拆包问题：粘包：多次发送的小数据在接收端一次性读到

### UDP基于报文
- 每次应用层的 send()，对应网络层的一个数据报文（Datagram）
- 内核不会合并，也不会把一个报文拆成多个给应用层
- 有边界：应用层一次 sendto() 对应接收端的一次 recvfrom()
- 可能丢包/乱序：UDP 不保证可靠传输，接收端可能丢掉某个数据报，或乱序到达


## 3.3 可靠性
### 3.3.1 TCP可靠
#### TCP 对数据分段
- TCP 把应用层的字节流切分成多个 报文段（Segment） 来发送
- MSS（Maximum Segment Size）：TCP 协商的“单个报文段最大有效载荷大小”
- <mark>MSS = MTU - IP头(20B) - TCP头(20B)，以太网典型：MTU=1500 → MSS=1460 字节</mark>
- <mark>MTU（Maximum Transmission Unit）：数据链路层能承载的最大帧数据长度，以太网常见 MTU=1500</mark>
- 滑动窗口（Flow Control）：接收方通过 TCP 头部的 Window 字段告诉发送方自己能接收的字节数
- TCP 报文段大小 不是固定的。依据上面的参数进行决定

#### 序列号 SEQ
- 保证数据 按序到达
- 确保完整接收
- 丢弃重复的数据

#### 校验和
- 检测报文在传输过程中的数据变化

#### 流量控制
- 接收端通过 窗口大小 (Window Size) 告诉发送端自己的接收能力
- 防止发送过快，导致接收端 buffer 溢出，包丢失

#### 拥塞控制 (Congestion Control)
- 通过算法（如 Reno、CUBIC、BBR）控制发送速率，避免网络拥塞
- 包括慢启动、拥塞避免、快重传、快恢复

#### 确认机制 (ACK)
- 接收方收到后会回一个 确认号 (Acknowledgment Number)
- 如果发送方没收到 ACK，就会重传

#### 重传机制 (Retransmission)
- 超时重传：发送方在定时器超时前没收到 ACK，就会重发；超时时间根据 RTT (往返时延) 动态调整（RTO 算法）
- 快速重传：如果连续收到多个重复 ACK，说明有报文丢了，会立刻重传，而不用等超时

### 3.3.2 UDP不可靠
#### 不保证交付
- UDP 报文可能丢失
- 不确认，不重传，无超时

#### 不保证交付顺序
- 无序列号，不重排

#### 无拥塞控制
- 网络拥塞不会降低发送速率

#### 无流量控制
- 对方接受缓冲区满，会直接丢弃


## 3.4 数据包大小
### UDP
#### 理论
- UDP 首部固定是 8 字节
- UDP 数据报最大能承载:2^16−1−8=65535−8=65527 字节
- 减去 IPv4 首部（通常 20 字节）后，剩余空间:65535 - 20 - 8 = 65507 字节

#### 实际
- MTU（Maximum Transmission Unit）= 1500字节
- 1500 - 20 IP - 8 UDP = 1472 字节

### TCP

#### TCP 的 MSS
- MSS = MTU - IP 首部长度 - TCP 首部长度
