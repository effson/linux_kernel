# 1.GDB/Qemu调试程序


# 2.task_struct结构体

## 2.1. 进程的两种特殊形式

### 2.1.1 内核线程
没有用户虚拟地址空间（mm == NULL）的进程，就是内核线程（Kernel Thread），这是 Linux 内核中的一个通用定义
### 2.1.2 用户线程
用户线程共享用户虚拟地址空间

## 2.2 Linux内核提供API函数设置进程状态
> task_struct->state
```
#define TASK_RUNNING            0 
#define TASK_INTERRUPTIBLE      1
#define TASK_UNINTERRUPTIBLE    2
#define __TASK_STOPPED          4
#define __TASK_TRACED           8
#define EXIT_ZOMBIE             16
#define EXIT_DEAD               32
#define TASK_DEAD               64
#define TASK_WAKEKILL           128
#define TASK_WAKING             256
#define TASK_PARKED             512
#define TASK_NOLOAD             1024
#define TASK_NEW                2048
#define TASK_STATE_MAX          4096
```
```
状态宏定义	        含义	被      描述
TASK_RUNNING	        运行/可运行	正在 CPU 上运行或在就绪队列中等待调度
TASK_INTERRUPTIBLE	可中断睡眠	睡眠状态，可被信号/唤醒事件中断，如 msleep()
TASK_UNINTERRUPTIBLE	不可中断睡眠	睡眠状态，不响应信号，常用于等待 IO
__TASK_STOPPED	        已停止	被      被 SIGSTOP、SIGTSTP 信号暂停
__TASK_TRACED	        被跟踪	被      被调试器（如 GDB）跟踪（traced）状态
EXIT_ZOMBIE	        僵尸进程	被      进程已终止，但其父进程未 wait()
EXIT_DEAD	        已死亡	被      僵尸进程资源即将释放，极短暂状态
```
## 2.3 Linux内核目录结构
### arch
```
功能：为不同 CPU 架构（如 x86、ARM、RISC-V、MIPS）提供特定实现。
子目录：x86/、arm/、riscv/ 等。
内容示例：
启动代码（boot）
中断处理（entry.S）
汇编与上下文切换逻辑
平台初始化、设备树支持
```
### block
```
块设备子系统
功能：实现块设备（如硬盘、SSD、NVMe）的通用支持框架。
内容示例：
通用块层 I/O 请求处理（如 I/O 调度器）
请求队列（request_queue）
多队列（blk-mq）处理机制
```
### documentation
```
功能：内核子系统、接口、模块、开发规范说明。
内容示例：
filesystems/ 文件系统接口文档
scheduler/ 调度器原理说明
.rst 格式，结合 Sphinx 生成 HTML 手册
```
### drivers
```
功能：各种硬件设备的驱动支持。
子目录示例：
net/ 网络驱动（如 Intel 网卡）
gpu/ 图形驱动
usb/ USB 控制器和设备
char/ 字符设备驱动
scsi/ SCSI 存储支持
Linux 驱动开发主要围绕这个目录展开。
```
### init
```
功能：内核启动后的初始化逻辑。
内容示例：
main.c：入口 start_kernel() 在这里定义
启动参数解析、子系统初始化、idle 任务创建等
```
### ipc
```
进程间通信
功能：System V IPC 支持，如：
msg.c 消息队列
sem.c 信号量
shm.c 共享内存
```
### kernel
```
核心子系统
功能：与调度器、信号、定时器、fork 等进程管理相关。
内容示例：
sched/ 调度器
time/ 时间管理
fork.c 进程创建
signal.c 信号处理
printk.c 日志系统
```
### lib
```
通用库代码
功能：非平台相关的工具函数，供全内核使用。
内容示例：
crc32.c 校验函数
kobject.c 内核对象模型
字符串、位图、哈希表等工具函数
```
### licenses
```
授权信息
功能：内核或模块的授权信息，支持 SPDX 标识
内容：
GPL-2.0、MIT、BSD 等许可证模板文件
模块可通过 SPDX 注释引入许可证标识
```
### mm
```
内存管理子系统
功能：核心内存管理实现。
内容示例：
虚拟地址到物理地址映射（页表）
页框分配器（buddy system, slab）
匿名页、文件映射、页面回收（swap）
NUMA 支持、HugePage 支持
```
### net
```
网络协议栈
功能：实现 Linux 网络子系统。
子目录：
ipv4/、ipv6/：实现 IP 协议
core/：socket、网络接口等通用核心
sched/：流量控制（TC）
bridge/、xfrm/、wireless/、unix/ 等特殊协议支持
```
### samples
### sound
### tools
### usr
### virt
```
虚拟化支持
功能：与虚拟化相关的框架支持，如：
KVM（Kernel-based Virtual Machine）
Xen、Hyper-V 等虚拟化平台
提供对 guest VM 的调度、IO 中断转发、hypercall 支持等

```
